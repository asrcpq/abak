change: split functions

todo: split, add test